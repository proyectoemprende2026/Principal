<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FondeoEmprende2026 | Consultor√≠a Integral de Fondeo</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --azul: #0a192f;
            --dorado: #d4af37;
            --dorado-claro: #f0d060;
            --verde: #004d40;
            --gris: #f4f7f6;
            --chat-bg: #0d1f36;
            --chat-accent: #d4af37;
            --chat-user: #1a3a5c;
            --chat-bot: #162640;
            --chat-width: 370px;
            --chat-height: 560px;
        }
        
        body {
            font-family: 'DM Sans', sans-serif;
            background-color: var(--gris);
            scroll-behavior: smooth;
        }

        .navbar-brand img { 
            height: 55px; 
            background: white; 
            padding: 4px; 
            border-radius: 8px; 
            box-shadow: 0 0 10px rgba(255,255,255,0.2);
        }

        .hero {
            background: linear-gradient(rgba(10, 25, 47, 0.88), rgba(10, 25, 47, 0.88)), 
                        url('https://images.unsplash.com/photo-1554224155-6726b3ff858f?auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            height: 90vh;
            display: flex;
            align-items: center;
            color: white;
            border-bottom: 5px solid var(--dorado);
        }

        .btn-gold {
            background-color: var(--dorado);
            color: var(--azul);
            font-weight: bold;
            border: none;
            padding: 12px 30px;
            transition: 0.3s;
        }
        .btn-gold:hover { background-color: #bfa030; transform: translateY(-3px); color: white; }

        .section-title { font-weight: 800; color: var(--azul); margin-bottom: 30px; font-family: 'Playfair Display', serif; }
        .card-service {
            border: none; border-radius: 15px; padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            background: white; transition: 0.3s;
        }
        .card-service:hover { transform: translateY(-5px); border-bottom: 4px solid var(--dorado); }

        .accordion-button:not(.collapsed) { background-color: #e9ecef; color: var(--azul); font-weight: bold; }

        footer { background-color: var(--azul); color: white; padding: 40px 0; border-top: 3px solid var(--dorado); }

        /* ===== CHATBOT ===== */
        #chat-bubble {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 12px;
        }

        #chat-toggle {
            width: 62px;
            height: 62px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--dorado), #b8962e);
            color: var(--azul);
            border: none;
            cursor: pointer;
            box-shadow: 0 6px 24px rgba(212,175,55,0.45);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
        }
        #chat-toggle:hover { transform: scale(1.08); box-shadow: 0 8px 32px rgba(212,175,55,0.6); }
        #chat-toggle .chat-icon-open  { transition: opacity 0.2s, transform 0.2s; }
        #chat-toggle .chat-icon-close { position: absolute; opacity: 0; transform: rotate(-90deg); transition: opacity 0.2s, transform 0.2s; }
        #chat-bubble.open #chat-toggle .chat-icon-open  { opacity: 0; transform: rotate(90deg); }
        #chat-bubble.open #chat-toggle .chat-icon-close { opacity: 1; transform: rotate(0deg); }

        #chat-badge {
            position: absolute;
            top: -4px; right: -4px;
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 20px; height: 20px;
            font-size: 11px;
            font-weight: 700;
            display: flex; align-items: center; justify-content: center;
            border: 2px solid white;
            animation: pulse-badge 1.8s infinite;
        }
        @keyframes pulse-badge { 0%,100%{transform:scale(1)} 50%{transform:scale(1.2)} }

        #chat-window {
            width: var(--chat-width);
            height: var(--chat-height);
            background: var(--chat-bg);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4), 0 0 0 1px rgba(212,175,55,0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: scale(0.85) translateY(20px);
            transform-origin: bottom right;
            opacity: 0;
            pointer-events: none;
            transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), opacity 0.25s ease;
        }
        #chat-bubble.open #chat-window {
            transform: scale(1) translateY(0);
            opacity: 1;
            pointer-events: all;
        }

        /* Header */
        .chat-header {
            background: linear-gradient(135deg, #0d1f36, #152a45);
            padding: 16px 18px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 2px solid rgba(212,175,55,0.3);
            flex-shrink: 0;
        }
        .chat-avatar {
            width: 42px; height: 42px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--dorado), #8a6a10);
            display: flex; align-items: center; justify-content: center;
            font-size: 18px;
            color: white;
            flex-shrink: 0;
        }
        .chat-header-info h6 { margin: 0; color: var(--dorado); font-weight: 700; font-size: 14px; font-family: 'Playfair Display', serif; }
        .chat-header-info small { color: #8aa0bb; font-size: 11px; }
        .chat-status-dot {
            width: 8px; height: 8px;
            background: #2ecc71;
            border-radius: 50%;
            margin-left: auto;
            box-shadow: 0 0 6px #2ecc71;
            animation: pulse-green 2s infinite;
        }
        @keyframes pulse-green { 0%,100%{opacity:1} 50%{opacity:0.4} }

        /* Messages */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px 14px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            scroll-behavior: smooth;
        }
        .chat-messages::-webkit-scrollbar { width: 4px; }
        .chat-messages::-webkit-scrollbar-track { background: transparent; }
        .chat-messages::-webkit-scrollbar-thumb { background: rgba(212,175,55,0.3); border-radius: 4px; }

        .msg {
            max-width: 88%;
            padding: 10px 14px;
            border-radius: 16px;
            font-size: 13.5px;
            line-height: 1.55;
            animation: msg-in 0.25s ease;
        }
        @keyframes msg-in { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }

        .msg.bot {
            background: var(--chat-bot);
            color: #cfe0f5;
            border-top-left-radius: 4px;
            align-self: flex-start;
            border: 1px solid rgba(255,255,255,0.06);
        }
        .msg.bot strong { color: var(--dorado-claro); }

        .msg.user {
            background: linear-gradient(135deg, var(--chat-user), #1e4a77);
            color: white;
            border-top-right-radius: 4px;
            align-self: flex-end;
        }

        /* Quick options */
        .chat-options {
            display: flex;
            flex-wrap: wrap;
            gap: 7px;
            padding: 0 14px 8px;
        }
        .opt-btn {
            background: transparent;
            border: 1.5px solid rgba(212,175,55,0.5);
            color: var(--dorado-claro);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: 0.2s;
            font-family: 'DM Sans', sans-serif;
            font-weight: 500;
        }
        .opt-btn:hover {
            background: rgba(212,175,55,0.15);
            border-color: var(--dorado);
            transform: translateY(-1px);
        }

        /* Input */
        .chat-input-area {
            padding: 12px 14px;
            display: flex;
            gap: 8px;
            border-top: 1px solid rgba(255,255,255,0.07);
            background: rgba(255,255,255,0.03);
            flex-shrink: 0;
        }
        #chat-input {
            flex: 1;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(212,175,55,0.2);
            color: white;
            border-radius: 24px;
            padding: 9px 16px;
            font-size: 13px;
            outline: none;
            font-family: 'DM Sans', sans-serif;
            transition: border-color 0.2s;
        }
        #chat-input::placeholder { color: #5a7a9a; }
        #chat-input:focus { border-color: rgba(212,175,55,0.6); background: rgba(255,255,255,0.1); }
        #chat-send {
            width: 38px; height: 38px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--dorado), #a87c10);
            border: none;
            color: var(--azul);
            cursor: pointer;
            font-size: 14px;
            display: flex; align-items: center; justify-content: center;
            transition: transform 0.2s;
            flex-shrink: 0;
        }
        #chat-send:hover { transform: scale(1.1); }

        /* Typing indicator */
        .typing-indicator {
            display: flex; gap: 5px; align-items: center;
            padding: 10px 14px;
            align-self: flex-start;
        }
        .typing-indicator span {
            width: 7px; height: 7px;
            background: var(--dorado);
            border-radius: 50%;
            animation: typing 1.2s infinite;
            opacity: 0.6;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%,80%,100%{transform:scale(1)} 40%{transform:scale(1.4);opacity:1} }

        /* Tooltip burbuja */
        #chat-tooltip {
            background: var(--azul);
            color: white;
            padding: 8px 14px;
            border-radius: 12px;
            font-size: 12.5px;
            font-family: 'DM Sans', sans-serif;
            white-space: nowrap;
            max-width: calc(100vw - 100px);
            overflow: hidden;
            text-overflow: ellipsis;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            border: 1px solid rgba(212,175,55,0.3);
            animation: fadeInTooltip 0.4s ease 1.5s both;
            cursor: pointer;
        }
        @keyframes fadeInTooltip { from{opacity:0;transform:translateX(10px)} to{opacity:1;transform:translateX(0)} }

        /* ===== RESPONSIVIDAD ===== */

        /* Hero responsive */
        @media (max-width: 991px) {
            .hero {
                height: auto;
                min-height: 80vh;
                padding: 80px 0 60px;
                text-align: center;
            }
            .hero .display-4 { font-size: 2rem; }
            .hero .lead { font-size: 1rem; }
            .hero .d-sm-flex { justify-content: center; }
        }

        @media (max-width: 576px) {
            .hero { min-height: 100svh; padding: 70px 0 50px; }
            .hero .display-4 { font-size: 1.65rem; line-height: 1.2; }
            .hero .btn { width: 100%; text-align: center; }
            .hero .d-grid { gap: 12px !important; }
        }

        /* Section responsive */
        @media (max-width: 767px) {
            .section-title { font-size: 1.6rem; }
            section.py-5 { padding-top: 2.5rem !important; padding-bottom: 2.5rem !important; }
            .container.py-5 { padding-top: 1.5rem !important; padding-bottom: 1.5rem !important; }
        }

        /* Navbar mobile */
        @media (max-width: 575px) {
            .navbar-brand span { font-size: 0.85rem; }
            .navbar-brand img { height: 42px; }
        }

        /* Accordion readable on small screens */
        @media (max-width: 576px) {
            .accordion-body { font-size: 0.9rem; }
        }

        /* ===== CHATBOT MOBILE ===== */
        @media (max-width: 500px) {
            :root {
                --chat-width: calc(100vw - 20px);
                --chat-height: 72svh;
            }
            #chat-bubble {
                bottom: 16px;
                right: 10px;
            }
            #chat-window {
                border-radius: 16px;
                /* Snap to left edge on small screens */
                margin-right: 0;
            }
            #chat-toggle {
                width: 54px;
                height: 54px;
                font-size: 22px;
            }
            #chat-tooltip {
                font-size: 11.5px;
                padding: 7px 12px;
            }
            .msg { font-size: 13px; }
            .opt-btn { font-size: 11.5px; padding: 5px 10px; }
            #chat-input { font-size: 13px; padding: 8px 14px; }
        }

        /* Extra small fix: chat window never goes off-screen */
        @media (max-width: 380px) {
            :root { --chat-height: 68svh; }
            .chat-header-info h6 { font-size: 12.5px; }
            .chat-header-info small { font-size: 10px; }
        }
    </style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark sticky-top" style="background-color: var(--azul);">
    <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="#">
            <img src="https://raw.githubusercontent.com/proyectoemprende2026/Plataforma/main/LogoFondeoEmprende2026.jpg" alt="Logo FondeoEmprende2026">
            <span class="ms-3 fw-bold d-none d-md-inline">FONDEO EMPRENDE 2026</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="#acompa√±amiento">Acompa√±amiento</a></li>
                <li class="nav-item"><a class="nav-link" href="#faq">Preguntas</a></li>
                <li class="nav-item ms-lg-3">
                    <a class="btn btn-gold btn-sm" href="https://proyectoemprende2026.github.io/Plataformac/" target="_blank">ACCESO PLATAFORMA</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- HERO -->
<section class="hero text-center text-lg-start">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-7">
                <h1 class="display-4 fw-bold mb-4" style="font-family:'Playfair Display',serif;">Gesti√≥n de Fondeo Internacional con Respaldo Consultor</h1>
                <p class="lead mb-5">En <strong>FondeoEmprende2026</strong>, transformamos la recepci√≥n de capital en una estructura financiera s√≥lida, transparente y libre de riesgos fiscales.</p>
                <div class="d-grid gap-3 d-sm-flex">
                    <a href="https://proyectoemprende2026.github.io/Plataformac/" target="_blank" class="btn btn-gold btn-lg">Acceder a mi Dashboard</a>
                    <a href="https://wa.me/522215736092" class="btn btn-outline-light btn-lg">Contactar Consultor</a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ACOMPA√ëAMIENTO -->
<section id="acompa√±amiento" class="py-5 bg-white">
    <div class="container py-5">
        <div class="row align-items-center">
            <div class="col-lg-5 mb-4 text-center">
                <img src="https://raw.githubusercontent.com/proyectoemprende2026/Plataforma/main/LogoFondeoEmprende2026.jpg" class="img-fluid rounded shadow-sm" style="max-height: 300px;" alt="Logo Corporativo">
            </div>
            <div class="col-lg-7">
                <h2 class="section-title">Acompa√±amiento Fiscal y Administrativo</h2>
                <p class="text-muted fs-5">Nuestra metodolog√≠a garantiza que cada peso ejercido cuente con el respaldo documental necesario para auditor√≠as internacionales y locales.</p>
                <div class="row mt-4">
                    <div class="col-md-6 mb-3">
                        <div class="p-3 border-start border-4 border-success bg-light">
                            <h6>Auditor√≠a de Comprobantes</h6>
                            <p class="small mb-0">Validaci√≥n t√©cnica de XML y PDF para asegurar deducibilidad absoluta.</p>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="p-3 border-start border-4 border-warning bg-light">
                            <h6>Blindaje ante el SAT</h6>
                            <p class="small mb-0">Estrategias preventivas para evitar discrepancia fiscal por ingresos de fondeo.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- FAQ -->
<section id="faq" class="py-5" style="background-color: #f0f2f5;">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="fw-bold" style="font-family:'Playfair Display',serif;">Centro de Ayuda</h2>
            <p class="text-muted">Resoluci√≥n r√°pida de dudas operativas</p>
        </div>
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="accordion shadow-sm" id="accordionFAQ">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#f1">
                                ¬øC√≥mo inicio sesi√≥n por primera vez?
                            </button>
                        </h2>
                        <div id="f1" class="accordion-collapse collapse show" data-bs-parent="#accordionFAQ">
                            <div class="accordion-body">
                                Debe realizar su registro en la secci√≥n de la plataforma. Al finalizar, el sistema le entregar√° un <strong>PIN de 4 d√≠gitos</strong> y un c√≥digo QR √∫nico.
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#f2">
                                ¬øQu√© hago si perd√≠ mi PIN?
                            </button>
                        </h2>
                        <div id="f2" class="accordion-collapse collapse" data-bs-parent="#accordionFAQ">
                            <div class="accordion-body">
                                Por razones de seguridad, los PINs est√°n encriptados. Si lo pierde, debe contactar a soporte t√©cnico de <strong>FondeoEmprende2026</strong> al n√∫mero 2211094255 para validar su identidad y restaurar el acceso.
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#f3">
                                ¬øC√≥mo deben ser los enlaces de Drive?
                            </button>
                        </h2>
                        <div id="f3" class="accordion-collapse collapse" data-bs-parent="#accordionFAQ">
                            <div class="accordion-body">
                                Para que nuestro equipo de auditor√≠a pueda validar sus gastos, aseg√∫rese de que el enlace de la factura est√© configurado como <strong>"Cualquier persona con el enlace puede ver"</strong>.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<footer>
    <div class="container text-center">
        <h5 class="fw-bold mb-3">FondeoEmprende2026</h5>
        <p class="mb-1 small">Despacho Consultor de Estrategia Financiera y Fondeo</p>
        <p class="text-muted mb-0 small">&copy; 2026 Todos los derechos reservados.</p>
    </div>
</footer>

<!-- ===== CHATBOT FLOTANTE ===== -->
<div id="chat-bubble">
    <span id="chat-tooltip" onclick="toggleChat()">üí¨ ¬øNecesitas orientaci√≥n?</span>

    <div id="chat-window">
        <!-- Header -->
        <div class="chat-header">
            <div class="chat-avatar">ü§ñ</div>
            <div class="chat-header-info">
                <h6>Asistente FondeoEmprende</h6>
                <small>Orientaci√≥n fiscal y de plataforma</small>
            </div>
            <div class="chat-status-dot"></div>
        </div>

        <!-- Messages -->
        <div class="chat-messages" id="chat-messages"></div>

        <!-- Quick options -->
        <div class="chat-options" id="chat-options"></div>

        <!-- Input -->
        <div class="chat-input-area">
            <input type="text" id="chat-input" placeholder="Escribe tu pregunta..." maxlength="200" />
            <button id="chat-send" onclick="sendUserMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <button id="chat-toggle" onclick="toggleChat()">
        <i class="fas fa-robot chat-icon-open"></i>
        <i class="fas fa-times chat-icon-close"></i>
        <span id="chat-badge">1</span>
    </button>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// ===== CHATBOT ENGINE =====
const messagesEl = document.getElementById('chat-messages');
const optionsEl  = document.getElementById('chat-options');
const inputEl    = document.getElementById('chat-input');
const bubbleEl   = document.getElementById('chat-bubble');
const badgeEl    = document.getElementById('chat-badge');
const tooltipEl  = document.getElementById('chat-tooltip');

let chatOpen = false;
let badgeHidden = false;

// Knowledge base
const KB = {
    bienvenida: {
        text: `¬°Hola! Soy tu asistente de <strong>FondeoEmprende2026</strong>. üëã\n\n¬øC√≥mo puedo orientarte hoy?`,
        opts: ['Soy nuevo ‚Äî quiero registrarme', 'Ya tengo NIP ‚Äî quiero acceder', '¬øQu√© son los fondos a fondo perdido?', 'Comprobaci√≥n de gastos', 'Problema t√©cnico']
    },
    nuevo: {
        text: `¬°Bienvenido! Para registrarte en la plataforma sigue estos pasos:\n\n1Ô∏è‚É£ Accede aqu√≠: <a href="https://proyectoemprende2026.github.io/Plataformac/" target="_blank" style="color:var(--dorado-claro)">Abrir Plataforma ‚Üí</a>\n2Ô∏è‚É£ Selecciona <strong>Nuevo registro</strong> y completa tus datos.\n3Ô∏è‚É£ Al finalizar recibir√°s un <strong>PIN de 4 d√≠gitos</strong> y un <strong>c√≥digo QR √∫nico</strong>.\n\n‚ö†Ô∏è Guarda tu PIN en un lugar seguro, est√° encriptado y no puede recuperarse sin soporte.`,
        opts: ['¬øQu√© documentos necesito?', '¬øQu√© son los fondos a fondo perdido?', 'Volver al inicio']
    },
    nip: {
        text: `Para ingresar con tu NIP:\n\n1Ô∏è‚É£ Entra a la plataforma: <a href="https://proyectoemprende2026.github.io/Plataformac/" target="_blank" style="color:var(--dorado-claro)">Abrir Plataforma ‚Üí</a>\n2Ô∏è‚É£ Ingresa tu <strong>PIN de 4 d√≠gitos</strong> en el acceso directo.\n3Ô∏è‚É£ Confirma con tu <strong>c√≥digo QR</strong> si el sistema lo solicita.\n\n¬øPerdiste tu PIN? Llama al <strong>2211094255</strong> para que soporte valide tu identidad y te lo restaure.`,
        opts: ['Perd√≠ mi PIN', 'Reportar otro problema', 'Volver al inicio']
    },
    pin_perdido: {
        text: `Sin problema. Para recuperar tu PIN:\n\nüìû Llama al n√∫mero de soporte t√©cnico: <strong>2211094255</strong>\n\nEl equipo validar√° tu identidad con los datos de tu registro original. Ten a la mano:\n‚Ä¢ Tu nombre completo registrado\n‚Ä¢ El proyecto o folio de fondeo asociado\n\nEl PIN no puede verse ni recuperarse desde el sistema por seguridad.`,
        opts: ['Volver al inicio', 'Contactar por WhatsApp']
    },
    fondos: {
        text: `üí° <strong>¬øQu√© son los fondos internacionales a fondo perdido?</strong>\n\nSon recursos econ√≥micos otorgados por organismos internacionales (BID, Banco Mundial, fundaciones, etc.) que <strong>no requieren devoluci√≥n</strong>, siempre que se cumplan las condiciones establecidas.\n\n<strong>¬øCu√°les son esas condiciones?</strong>\n‚Ä¢ Ejecutar el proyecto conforme al plan aprobado\n‚Ä¢ Comprobar cada gasto con facturaci√≥n oficial\n‚Ä¢ Presentar informes peri√≥dicos al organismo otorgante\n‚Ä¢ Evitar desv√≠os de recursos`,
        opts: ['¬øC√≥mo accedo a uno?', 'Requisitos para M√©xico', 'Comprobaci√≥n de gastos', 'Implicaciones fiscales (SAT)', 'Volver al inicio']
    },
    acceso_fondos: {
        text: `üåê <strong>¬øC√≥mo se accede a fondos a fondo perdido?</strong>\n\nEl proceso t√≠pico es:\n\n1. <strong>Identificar la convocatoria</strong> adecuada al giro y tama√±o del proyecto.\n2. <strong>Elaborar un plan de negocio</strong> con presupuesto detallado.\n3. <strong>Presentar solicitud</strong> ante el organismo o su representante en M√©xico.\n4. <strong>Firma del convenio</strong> de uso y comprobaci√≥n.\n5. <strong>Recepci√≥n y ejecuci√≥n</strong> del recurso con acompa√±amiento como el de FondeoEmprende2026.`,
        opts: ['Requisitos para M√©xico', 'Comprobaci√≥n de gastos', 'Volver al inicio']
    },
    requisitos: {
        text: `üìã <strong>Requisitos generales para acceder en M√©xico</strong>\n\n‚Ä¢ Ser persona moral o f√≠sica con actividad empresarial\n‚Ä¢ RFC activo y sin adeudos ante el <strong>SAT</strong>\n‚Ä¢ Proyecto con impacto social, ambiental o productivo demostrable\n‚Ä¢ Estados financieros de los √∫ltimos 2 ejercicios\n‚Ä¢ Plan de trabajo con metas medibles\n‚Ä¢ Apertura de cuenta bancaria exclusiva para el proyecto\n\n‚ö†Ô∏è Cada convocatoria puede agregar requisitos espec√≠ficos.`,
        opts: ['Comprobaci√≥n de gastos', 'Implicaciones fiscales (SAT)', 'Volver al inicio']
    },
    comprobacion: {
        text: `üìÇ <strong>Comprobaci√≥n de gastos del fondo</strong>\n\nEn la plataforma, cada gasto debe respaldarse as√≠:\n\n1. <strong>Factura CFDI</strong> (XML + PDF) del proveedor.\n2. Subir los archivos a <strong>Google Drive</strong> con acceso p√∫blico ("Cualquier persona con el enlace puede ver").\n3. Pegar el enlace en el m√≥dulo de comprobantes de tu dashboard.\n4. Nuestro equipo valida la autenticidad del XML ante el SAT.\n\n‚úÖ Solo comprobantes con XML v√°lido son aceptados como gasto elegible.`,
        opts: ['Implicaciones fiscales (SAT)', '¬øQu√© gastos son elegibles?', 'Volver al inicio']
    },
    fiscal: {
        text: `‚öñÔ∏è <strong>Implicaciones fiscales ante el SAT</strong>\n\nRecibir fondos internacionales genera obligaciones fiscales:\n\n‚Ä¢ Los recursos pueden clasificarse como <strong>ingresos acumulables</strong> si no se estructura correctamente.\n‚Ä¢ FondeoEmprende2026 aplica una estrategia de <strong>blindaje fiscal preventivo</strong> para evitar discrepancias.\n‚Ä¢ Se documentan los fondos como <strong>aportaciones no reembolsables</strong> con respaldo del convenio internacional.\n‚Ä¢ Los gastos comprobados con CFDI son 100% deducibles.\n\nüí° Recomendamos no mezclar los recursos del fondo con cuentas de operaci√≥n habitual.`,
        opts: ['Comprobaci√≥n de gastos', '¬øQu√© gastos son elegibles?', 'Volver al inicio']
    },
    elegibles: {
        text: `‚úÖ <strong>Gastos elegibles (los m√°s comunes)</strong>\n\n‚Ä¢ Adquisici√≥n de maquinaria o equipo productivo\n‚Ä¢ Pago de servicios profesionales especializados\n‚Ä¢ Capacitaci√≥n y desarrollo del equipo\n‚Ä¢ Tecnolog√≠a y software con factura\n‚Ä¢ Infraestructura f√≠sica vinculada al proyecto\n\n‚ùå <strong>Gastos NO elegibles:</strong>\n‚Ä¢ Sueldos o n√≥mina regular\n‚Ä¢ Gastos de representaci√≥n sin justificaci√≥n\n‚Ä¢ Compras sin factura CFDI v√°lida\n‚Ä¢ Pagos a empresas sin actividad real (EFOS)`,
        opts: ['Comprobaci√≥n de gastos', 'Implicaciones fiscales (SAT)', 'Volver al inicio']
    },
    documentos: {
        text: `üìé <strong>Documentos clave para tu registro</strong>\n\n‚Ä¢ Identificaci√≥n oficial vigente\n‚Ä¢ RFC con homoclave\n‚Ä¢ Comprobante de domicilio reciente\n‚Ä¢ N√∫mero de folio o convenio de fondeo (si ya lo tienes)\n‚Ä¢ Correo electr√≥nico activo\n\nSi a√∫n no cuentas con tu convenio, puedes registrarte de manera preventiva y completarlo despu√©s.`,
        opts: ['Soy nuevo ‚Äî quiero registrarme', 'Volver al inicio']
    },
    tecnico: {
        text: `üîß <strong>Problemas t√©cnicos</strong>\n\nPara cualquier falla en la plataforma:\n\nüìû <strong>Soporte:</strong> 2211094255\nüí¨ <strong>WhatsApp:</strong> 2215736092\n\nTen a la mano una descripci√≥n del error o captura de pantalla. El equipo responde en horario h√°bil (Lun‚ÄìVie 9‚Äì18h).`,
        opts: ['Contactar por WhatsApp', 'Volver al inicio']
    },
    whatsapp: {
        text: `üì≤ Puedes contactar directamente a un consultor por WhatsApp:\n\nüëâ <a href="https://wa.me/522215736092" target="_blank" style="color:var(--dorado-claro)">Abrir WhatsApp ‚Äî 2215736092</a>\n\nTe atender√° un asesor especializado en fondos internacionales y comprobaci√≥n fiscal.`,
        opts: ['Volver al inicio']
    },
    inicio: null // handled in code
};

const intents = {
    'Soy nuevo ‚Äî quiero registrarme': 'nuevo',
    'Ya tengo NIP ‚Äî quiero acceder': 'nip',
    '¬øQu√© son los fondos a fondo perdido?': 'fondos',
    'Comprobaci√≥n de gastos': 'comprobacion',
    'Problema t√©cnico': 'tecnico',
    'Perd√≠ mi PIN': 'pin_perdido',
    'Reportar otro problema': 'tecnico',
    '¬øC√≥mo accedo a uno?': 'acceso_fondos',
    'Requisitos para M√©xico': 'requisitos',
    'Implicaciones fiscales (SAT)': 'fiscal',
    '¬øQu√© gastos son elegibles?': 'elegibles',
    '¬øQu√© documentos necesito?': 'documentos',
    'Contactar por WhatsApp': 'whatsapp',
    'Volver al inicio': 'bienvenida',
};

// NLP ligero
function detectIntent(text) {
    const t = text.toLowerCase();
    if (/nip|pin|contrase√±a|acceder|acceso/.test(t)) return 'nip';
    if (/registro|nuevo|primera vez|registrar/.test(t)) return 'nuevo';
    if (/fondo perdido|fondos internacionales|qu√© son|grant/.test(t)) return 'fondos';
    if (/comprobar|comprobaci√≥n|factura|cfdi|drive|xml/.test(t)) return 'comprobacion';
    if (/sat|fiscal|impuesto|deducible|acumulable/.test(t)) return 'fiscal';
    if (/requisito|documento|necesito/.test(t)) return 'requisitos';
    if (/elegible|gasto permitido|qu√© puedo/.test(t)) return 'elegibles';
    if (/perd√≠|olvid√©|no recuerdo|recuperar/.test(t)) return 'pin_perdido';
    if (/whatsapp|contacto|tel√©fono|llamar/.test(t)) return 'whatsapp';
    if (/error|falla|problema|t√©cnico/.test(t)) return 'tecnico';
    if (/c√≥mo accedo|obtener fondo|solicitar/.test(t)) return 'acceso_fondos';
    return null;
}

function addMsg(text, role) {
    const div = document.createElement('div');
    div.className = `msg ${role}`;
    div.innerHTML = text.replace(/\n/g, '<br>');
    messagesEl.appendChild(div);
    messagesEl.scrollTop = messagesEl.scrollHeight;
}

function showTyping() {
    const t = document.createElement('div');
    t.className = 'typing-indicator';
    t.id = 'typing';
    t.innerHTML = '<span></span><span></span><span></span>';
    messagesEl.appendChild(t);
    messagesEl.scrollTop = messagesEl.scrollHeight;
}

function removeTyping() {
    const t = document.getElementById('typing');
    if (t) t.remove();
}

function setOptions(opts) {
    optionsEl.innerHTML = '';
    if (!opts) return;
    opts.forEach(o => {
        const btn = document.createElement('button');
        btn.className = 'opt-btn';
        btn.textContent = o;
        btn.onclick = () => handleOption(o);
        optionsEl.appendChild(btn);
    });
}

function handleOption(label) {
    addMsg(label, 'user');
    setOptions([]);
    const key = intents[label];
    if (!key) return;
    respond(key);
}

function respond(key) {
    showTyping();
    setTimeout(() => {
        removeTyping();
        const entry = KB[key];
        if (!entry) { respond('bienvenida'); return; }
        addMsg(entry.text, 'bot');
        setOptions(entry.opts || []);
    }, 700 + Math.random() * 400);
}

function sendUserMessage() {
    const text = inputEl.value.trim();
    if (!text) return;
    addMsg(text, 'user');
    inputEl.value = '';
    setOptions([]);
    const intent = detectIntent(text);
    showTyping();
    setTimeout(() => {
        removeTyping();
        if (intent && KB[intent]) {
            addMsg(KB[intent].text, 'bot');
            setOptions(KB[intent].opts || []);
        } else {
            addMsg(`Entiendo tu pregunta. Para darte la mejor orientaci√≥n, elige una de las opciones o cont√°ctanos directamente:\n\nüìû <strong>2211094255</strong> | üí¨ WhatsApp: <strong>2215736092</strong>`, 'bot');
            setOptions(['¬øQu√© son los fondos a fondo perdido?', 'Comprobaci√≥n de gastos', 'Contactar por WhatsApp', 'Volver al inicio']);
        }
    }, 800);
}

function toggleChat() {
    chatOpen = !chatOpen;
    bubbleEl.classList.toggle('open', chatOpen);

    if (chatOpen && !badgeHidden) {
        badgeEl.style.display = 'none';
        tooltipEl.style.display = 'none';
        badgeHidden = true;
        // Greet
        setTimeout(() => {
            addMsg(KB.bienvenida.text, 'bot');
            setOptions(KB.bienvenida.opts);
        }, 300);
    }
}

// Enter key
inputEl.addEventListener('keydown', e => { if (e.key === 'Enter') sendUserMessage(); });

// Auto-hide tooltip after 8s
setTimeout(() => {
    if (tooltipEl) tooltipEl.style.display = 'none';
}, 8000);
</script>
</body>
</html>
